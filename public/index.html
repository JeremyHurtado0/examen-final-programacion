<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panel de Tours</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="script.js"></script>

  <style>
    body {
      background: linear-gradient(to bottom, #e0f7fa, #ffffff);
      font-family: 'Segoe UI', sans-serif;
      min-height: 100vh;
    }
    .card {
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
      border-radius: 20px;
      overflow: hidden;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .card:hover {
      transform: translateY(-8px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    }
    .card-img-top {
      height: 180px; /* altura del banner de la tarjeta */
      object-fit: cover; /* cubre todo el espacio sin deformar */
      width: 100%;
    }
    .btn-custom {
      border-radius: 25px;
      padding: 8px 20px;
    }
    .titulo {
      font-weight: 700;
      color: #0077b6;
    }
    /* Banner superior de la p√°gina */
    .banner-top {
      width: 100%;
      max-height: 300px;
      object-fit: cover;
      margin-bottom: 15px;
      border-radius: 15px;
    }
  </style>
</head>
<body class="p-4">

  <div class="container">
    <br><br>

    <!-- Banner superior -->
    <div class="text-center mb-4">
<img src="Gemini_Generated_Image_p4la9ip4la9ip4la.png" class="banner-top">
      <h1 class="titulo mt-3">Explora Esmeraldas, tu pr√≥ximo destino.</h1>
    </div>

    <!-- Bot√≥n general para obtener todos -->
    <div class="text-center mb-4">
      <button id="btnObtenerTodos" class="btn btn-primary btn-lg shadow-sm">
         Obtener todos los tours y servicios
      </button>
    </div>

    <!-- Formulario -->
    <div class="card mb-4">
      <div class="card-body">
        <h4 class="card-title text-success mb-3">Agregar o Actualizar Tour</h4>
        <form id="tourForm">
          <div class="row g-3">
            <div class="col-md-4">
              <input type="text" id="id" class="form-control" placeholder="ID (solo para actualizar o eliminar)">
            </div>
            <div class="col-md-4">
              <input type="text" id="nombre" class="form-control" placeholder="Nombre del tour" required>
            </div>
            <div class="col-md-4">
              <input type="text" id="categoria" class="form-control" placeholder="Categor√≠a">
            </div>
            <div class="col-md-4">
              <input type="text" id="duracion" class="form-control" placeholder="Duraci√≥n (ej: 3 d√≠as)">
            </div>
            <div class="col-md-4">
              <input type="number" id="precio" class="form-control" placeholder="Precio (USD)">
            </div>
            <div class="col-md-4">
              <select id="tipo" class="form-select">
                <option value="Producto">Producto</option>
                <option value="Servicio">Servicio</option>
              </select>
            </div>
            <div class="col-12">
              <textarea id="descripcion" class="form-control" placeholder="Descripci√≥n del tour o servicio"></textarea>
            </div>
          </div>
          <div class="mt-3 text-center">
            <button type="submit" class="btn btn-success btn-custom">Agregar</button>
            <button type="button" id="btnActualizar" class="btn btn-warning btn-custom"> Actualizar</button>
            <button type="button" id="btnEliminar" class="btn btn-danger btn-custom"> Eliminar</button>
            <button type="button" id="btnObtenerPorId" class="btn btn-info btn-custom"> Obtener por ID</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Lista de tours -->
    <h3 class="text-secondary mb-3 text-center"> Lista de Tours </h3>
    <div class="row" id="toursContainer"></div>
  </div>

  <script>
    const apiUrl = 'http://localhost:3000/api/turismo';

    const container = document.getElementById('toursContainer');
    const form = document.getElementById('tourForm');

    // Imagen espec√≠fica para el tour "EsmeCity Tours"
   const imagenes = {
  'EsmeCity': 'Gemini_Generated_Image_p4la9ip4la9ip4la.png',
  'default': 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=1200&q=80'
};


    async function obtenerTodos() {
      try {
        const res = await fetch(apiUrl);
        const data = await res.json();
        mostrarTours(Array.isArray(data) ? data : [data]);
      } catch (error) {
        alert('Error al obtener todos los registros');
      }
    }

    async function obtenerPorId() {
      const id = document.getElementById('id').value.trim();
      if (!id) return alert('Ingresa un ID para buscar.');
      try {
        const res = await fetch(`${apiUrl}/${id}`);
        if (res.status === 404) return alert('No se encontr√≥ el registro.');
        const data = await res.json();
        mostrarTours([data]);
      } catch (error) {
        alert('Error al obtener por ID');
      }
    }

    function mostrarTours(tours) {
      container.innerHTML = '';
      if (!tours || tours.length === 0) {
        container.innerHTML = '<div class="col-12 text-center text-muted">No hay registros disponibles</div>';
        return;
      }

      tours.forEach(tour => {
        // Usar imagen espec√≠fica si el nombre contiene "EsmeCity", si no default
        const clave = Object.keys(imagenes).find(k =>
          tour.nombre?.includes(k) || tour.categoria?.includes(k)
        );
        const img = imagenes[clave] || imagenes['default'];

        container.innerHTML += `
          <div class="col-md-4 mb-4">
            <div class="card h-100" onclick="llenarFormulario('${tour._id}')" style="cursor:pointer;">
              <img src="${img}" class="card-img-top" alt="${tour.nombre}">
              <div class="card-body">
                <h5 class="card-title text-primary">${tour.nombre}</h5>
                <p>${tour.descripcion || 'Sin descripci√≥n'}</p>
                <p><strong>Categor√≠a:</strong> ${tour.categoria || '-'}</p>
                <p><strong>Duraci√≥n:</strong> ${tour.duracion || '-'}</p>
                <p><strong>Precio:</strong> $${tour.precio ?? '-'}</p>
                <p><strong>Tipo:</strong> ${tour.tipo}</p>
                <p class="text-muted"><strong>ID:</strong> ${tour._id}</p>
                <div class="d-flex gap-2">
                  <button class="btn btn-outline-danger btn-sm" onclick="event.stopPropagation(); eliminar('${tour._id}')">üóëÔ∏è Eliminar</button>
                </div>
              </div>
            </div>
          </div>`;
      });
    }

    async function llenarFormulario(id) {
      const res = await fetch(`${apiUrl}/${id}`);
      const data = await res.json();
      document.getElementById('id').value = data._id;
      document.getElementById('nombre').value = data.nombre;
      document.getElementById('descripcion').value = data.descripcion;
      document.getElementById('categoria').value = data.categoria;
      document.getElementById('duracion').value = data.duracion;
      document.getElementById('precio').value = data.precio;
      document.getElementById('tipo').value = data.tipo;
    }

    form.addEventListener('submit', async e => {
      e.preventDefault();
      const nuevo = {
        tipo: tipo.value,
        nombre: nombre.value,
        descripcion: descripcion.value,
        categoria: categoria.value,
        duracion: duracion.value,
        precio: parseFloat(precio.value)
      };
      await fetch(apiUrl, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(nuevo)
      });
      form.reset();
      obtenerTodos();
    });

    document.getElementById('btnActualizar').addEventListener('click', async () => {
      const id = document.getElementById('id').value.trim();
      if (!id) return alert('Debes ingresar un ID para actualizar.');
      const actualizado = {
        nombre: nombre.value,
        descripcion: descripcion.value,
        categoria: categoria.value,
        duracion: duracion.value,
        precio: parseFloat(precio.value),
        tipo: tipo.value
      };
      await fetch(`${apiUrl}/${id}`, {
        method: 'PUT',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(actualizado)
      });
      alert('Registro actualizado correctamente');
      obtenerTodos();
    });

    async function eliminar(id) {
      if (!confirm('¬øSeguro que deseas eliminar este tour?')) return;
      await fetch(`${apiUrl}/${id}`, { method: 'DELETE' });
      alert('Tour eliminado correctamente');
      obtenerTodos();
    }

    document.getElementById('btnEliminar').addEventListener('click', async () => {
      const id = document.getElementById('id').value.trim();
      if (!id) return alert('Debes ingresar un ID para eliminar.');
      eliminar(id);
    });

    document.getElementById('btnObtenerTodos').addEventListener('click', obtenerTodos);
    document.getElementById('btnObtenerPorId').addEventListener('click', obtenerPorId);

    obtenerTodos();
  </script>
</body>
</html>
